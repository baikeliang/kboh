{"version":3,"sources":["webpack:///./app/server/server.js?b2ef","webpack:///./app/redux/middleware/clientMiddleware.js?90ba"],"names":["global","__CLIENT__","__SERVER__","app","use","publicPath","output","stats","colors","resolve","alias","HTML","content","store","__html","getState","get","req","res","console","log","code","undefined","openid","u","append","redirect","next","memoryHistory","url","client","history","indexOf","query","routes","location","error","redirectLocation","renderProps","status","send","message","pathname","search","params","then","err","info","listen","clientMiddleware","dispatch","action","type","promise","types","rest","REQUEST","SUCCESS","FAILURE","actionPromise","result","catch"],"mappings":"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","file":"0.4a752034f3299cffffe7.hot-update.js","sourcesContent":["/*eslint-disable no-console */\nimport express from 'express'\nimport serialize from 'serialize-javascript'\n\nimport webpack from 'webpack'\nimport webpackDevMiddleware from 'webpack-dev-middleware'\nimport webpackConfig from '../../webpack.client.config.js'\n\nimport React from 'react'\nimport { renderToString } from 'react-dom/server'\nimport { Provider } from 'react-redux'\nimport { createMemoryHistory, match, RouterContext } from 'react-router'\nimport { syncHistoryWithStore } from 'react-router-redux'\n\nimport { ReduxAsyncConnect, loadOnServer } from 'redux-connect'\n\nimport { configureStore } from 'app/configure-store.js'\n\nimport routes from 'app/routes'\n\nimport jwt from 'jsonwebtoken'\n\nimport ApiClient from 'app/isomorphic-api/ApiClient'\n\nimport { URLSearchParams } from 'url-search-params-polyfill'\n\nimport ajax from './interface/interface.js'\n\nimport Promise from 'bluebird'\n\nglobal.__CLIENT__ = false;\nglobal.__SERVER__ = true;\n\nconst app = express()\n\napp.use(webpackDevMiddleware(webpack(webpackConfig), {\n  publicPath: webpackConfig.output.publicPath,\n  stats: {\n    colors: true\n  },\n  resolve: {\n        alias: {\n            app: webpackConfig.resolve.alias.app\n        }\n    }\n}))\n\nconst HTML = ({ content, store }) => (\n  <html lang=\"en\">\n    <head>\n        <meta charSet=\"utf-8\"/>\n        <title>登陆</title>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1\"/>\n        <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.3.1/css/swiper.min.css\"/>\n    </head>\n    <body>\n      <div id=\"root\" dangerouslySetInnerHTML={{ __html: content }}/>\n      <div id=\"devtools\"/>\n      <script dangerouslySetInnerHTML={{ __html: `window.__initialState__=${serialize(store.getState())};` }}/>\n      <script src=\"/bundle.js\"/>\n    </body>\n  </html>\n)\n\napp.get('/wxcallback/auth',function(req,res){\n\n    console.log('enter /wxcallback/auth !!!!!')\n    /*\n    var code = req.query.code\n    var type = req.query.type\n    */\n    var code = 'haha'\n\n\n\n    if (code === undefined || code === null) {\n\n\n    } else {\n        /// sync get openid\n        let openid = 'asdaaaaa'\n\n        let u = new URLSearchParams();\n        \n        console.log('KKKKKKKK'+u)\n\n        u.append('openid', openid);\n        res.redirect('/usercenter/rest?'+u)\n\n    }\n\n\n});\n\napp.use(function (req, res, next) {\n  const memoryHistory = createMemoryHistory(req.url)\n  const client = new ApiClient(req)\n  const store = configureStore(memoryHistory,client)\n  const history = syncHistoryWithStore(memoryHistory, store)\n  \n  var url = req.url\n\n  if(req.url.indexOf('/wxcallback')==0){\n      next();\n      return;\n  }\n  else if(req.url.indexOf('/usercenter/rest?')==0){\n      var openid = req.query.openid\n      console.log('openid!!!!!!!   '+openid)\n      url = '/usercenter'\n\n  }\n  console.log('to match  '+url)\n  match({ history, routes, location: url }, (error, redirectLocation, renderProps) => {\n    if (error) {\n      res.status(500).send(error.message)\n    } else if (redirectLocation) {\n      res.redirect(302, redirectLocation.pathname + redirectLocation.search)\n    } else if (renderProps) {\n      console.log('to match2')\n      loadOnServer({ ...renderProps, store, params:{openid}}).then(() => {\n      console.log('AAAAAAAAA   '+url)\n      // 2. use `ReduxAsyncConnect` instead of `RoutingContext` and pass it `renderProps` \n      const content = renderToString(\n        <Provider store={store} key=\"provider\">\n          <ReduxAsyncConnect {...renderProps} />\n        </Provider>\n      )\n\n      res.send('<!doctype html>\\n' + renderToString(<HTML content={content} store={store}/>))\n    },(err)=>{\n      if(err.info == 'auth')\n        res.redirect('/login')\n    })\n    }\n  })\n})\n\napp.listen(3000, function () {\n  console.log('Server listening on http://localhost:3000, Ctrl+C to stop')\n})\n\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./app/server/server.js\n **/","export default function clientMiddleware(client) {\n  return ({dispatch, getState}) => {\n    return next => action => {\n      console.log('JJJJJJJJJJJJGG  '+action.type)\n      const { promise, types, ...rest } = action; // eslint-disable-line no-redeclare\n      if (!promise) {\n        return next(action);\n      }\n      console.log('JJJJJJJJJJJJTT')\n      const [REQUEST, SUCCESS, FAILURE] = types;\n      next({...rest, type: REQUEST});\n      console.log('JJJJJJJJJJJJTTRRRRR')\n      console.log(client)\n      const actionPromise = promise(client);\n      console.log('JJJJJJJJJJJJTTYY')\n      actionPromise.then(\n        (result) => next({...rest, result, type: SUCCESS}),\n        (error) => next({...rest, error, type: FAILURE})\n      ).catch((error)=> {\n        console.error('MIDDLEWARE ERROR:', error);\n        next({...rest, error, type: FAILURE});\n      });\n\n      return actionPromise;\n    };\n  };\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./app/redux/middleware/clientMiddleware.js\n **/"],"sourceRoot":""}